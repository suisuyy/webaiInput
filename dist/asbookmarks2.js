javascript:(function(){ alert(888)  })();


javascript:(function(){ const devilentLIBS={Recorder:class e{constructor(e){this.apiKey=e,this.isRecording=!1,this.mediaRecorder,this.encodeType="audio/mpeg",this.language="en",this.recordingColor="lightblue"}async startRecording(e,t){if(this.isRecording){console.log("already recording");return}return console.log("start recording"),navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{this.mediaRecorder=new MediaRecorder(t);let o=this.mediaRecorder,n=[];o.start(),this.isRecording=!0,e.style.backgroundColor="rgba(173, 216, 230, 0.5)";let i,r;r=new AudioContext;let a=r.createAnalyser(),s=r.createMediaStreamSource(o.stream);s.connect(a),a.fftSize=512;let l=a.frequencyBinCount,d=new Uint8Array(l),c=()=>{a.getByteFrequencyData(d);let t=0;for(let o=0;o<l;o++)t+=d[o];let n=t/l;e.style.transform=`scale(${3+n/15})`};return i=setInterval(c,100),o.addEventListener("dataavailable",e=>{console.log("dataavailable"),n.push(e.data)}),new Promise((t,a)=>{o.addEventListener("stop",async()=>{this.isRecording=!1,console.log("stop"),clearInterval(i);let a=new Blob(n,{type:this.encodeType});e.style.transform="scale(1)",e.style.background="transparent",r?.close(),o.stream.getTracks().forEach(e=>e.stop()),console.log("resolved "),t(a)})})})}stopRecording(){this.isRecording=!1,this.mediaRecorder.stop()}},showToast:function e(t,o=0,n=0,i=200,r=100,a=2e3,s=99999){let l=document.createElement("textarea");l.value=t,l.style.width=i+"px",l.style.height=r+"px",l.style.borderWidth="0",l.style.outline="none",l.style.position="fixed",l.style.left=o+"px",l.style.bottom=n+"px",l.style.zIndex=s,l.disabled=!0,document.body.appendChild(l),setTimeout(()=>{document.body.removeChild(l)},a)},copyToClipboard:function e(t){let o=document.createElement("textarea");o.value=t,o.style.width="50%",o.style.height="100px",o.style.borderWidth="0",o.style.outline="none",o.style.position="fixed",o.style.left="0",o.style.bottom="0",o.style.zIndex="9999999",document.body.appendChild(o),o.select(),document.execCommand("copy"),o.disabled=!0,o.value="copyed to clipboard \n"+o.value,o.scrollTo(1e4,1e5),setTimeout(()=>{document.body.removeChild(o)},4e3)},dragElement:function e(t,o=t.parentElement,n=3){t.style.touchAction="none";var i=0,r=0,a=0,s=0;let l,d;function c(e){(e=e||window.event).preventDefault(),i=a-e.clientX,r=s-e.clientY,o.style.position="fixed",o.style.top=e.clientY-o.clientHeight/2+"px",o.style.left=e.clientX-o.clientWidth/2+"px"}function p(){console.log("closeDragElement(): pointerup"),document.body.removeEventListener("pointermove",c),document.body.removeEventListener("pointerup",p),document.body.removeChild(l),clearTimeout(d)}t.addEventListener("pointerdown",e=>{var t;t=e,(t=t||window.event).preventDefault(),a=t.clientX,s=t.clientY,document.body.addEventListener("pointermove",c),document.body.addEventListener("pointerup",p),(l=document.createElement("div")).style.width="300vw",l.style.height="300vh",l.style.position="fixed",l.style.top="0",l.style.left="0",l.style.backgroundColor="rgb(230,230,230,0.2)",l.style.zIndex=1e5,document.body.appendChild(l),d=setTimeout(()=>{document.body.removeChild(l)},1e4),console.log(t.clientX,t.clientY)})},writeText:function e(t,o,n=" ",i=" "){"BODY"===t.tagName?copyToClipboard(o):(document.execCommand("insertText",!1,`${n}${o}${i}`),t.scrollTo(1e5,1e6))},moveToElement(e,t,o=!0){let n=t.getBoundingClientRect(),i=n.left+.85*n.width,r=n.top;o&&(i=Math.abs(i),r=Math.abs(r),i=Math.min(i,window.innerWidth-e.clientWidth),r=Math.min(r,window.innerHeight-10-e.clientHeight)),e.style.left=i+"px",e.style.top=r+"px"},addEventListenerForActualClick(e,t){let o,n;e.addEventListener("pointerdown",e=>{o=e.clientX,n=e.clientY}),e.addEventListener("pointerup",e=>{let i=Math.abs(e.clientX-o),r=Math.abs(e.clientY-n);i<=10&&r<=10&&(console.log("Minimal mouse movement (< 10px in either direction) detected."),t(e))})},blobToBase64:function e(t){if(!(t instanceof Blob))throw TypeError("Parameter must be a Blob object.");if(!t.size)throw Error("Empty Blob provided.");return new Promise((e,o)=>{let n=new FileReader;n.onload=()=>e(n.result.split(",")[1]),n.onerror=o,n.readAsDataURL(t)})},playAudioBlob:function e(t){let o=new Audio;o.src=URL.createObjectURL(t),o.controls=!0,document.body.appendChild(o),o.play().then(()=>{console.log("Audio played successfully!")}).catch(e=>{console.error("Error playing audio:",e)})}};let dragElement=devilentLIBS.dragElement,Recorder=devilentLIBS.Recorder,writeText=devilentLIBS.writeText,copyToClipboard=devilentLIBS.copyToClipboard,showToast=devilentLIBS.showToast,moveToElement=devilentLIBS.moveToElement,addEventListenerForActualClick=devilentLIBS.addEventListenerForActualClick,blobToBase64=devilentLIBS.blobToBase64,playAudioBlob=devilentLIBS.playAudioBlob,model={api_url:"",api_key:"",voice_button_id:"whisper_voice_button",transcribeProvider:"lepton_whisper",language:"",supportedInputTypeList:["text","number","tel","search","url","email"],buttonBackgroundColor:"lightblue"},view={elem:{currentInputElem:null,voiceButton:null},init(){this.recorder=new Recorder,this.createButton(),setInterval(()=>{let e=document.getElementById("whisper_voice_button");!e&&this.createButton()},2e3)},createButton(){let e=document.getElementById("whisper_voice_button");if(e)return;console.log("create button");let t=document.createElement("button");return this.elem.voiceButton=t,t.id=model.voice_button_id,t.innerText="â—¯",t.type="button",t.classList.add("speech-to-text-button"),t.style.top=window.innerHeight-100+"px",t.style.left="0",t.style.width="40px",t.style.height=t.style.width,t.style.fontSize="30px",t.style.border="0px",t.style.color="blue",t.style.background="transparent",t.style.zIndex=1e6,t.style.position="fixed",t.style.borderRadius="50%",t.style.userSelect="none",t.style.touchAction="none",document.body.appendChild(t),dragElement(t,t),t.addEventListener("click",()=>{console.log("clicked")}),t.addEventListener("pointerdown",async e=>{e.preventDefault();let t=Date.now(),o=await this.recorder.startRecording(this.elem.voiceButton);if(Date.now()-t<1500){showToast("time too short, this will not transcribe");return}let n=await sendAudioToLeptonWhisperApi(o);!1===n&&(console.log("transcribe failed, try alternative way"),n=await whisperjaxws(o)),writeText(document.activeElement,n)}),t.addEventListener("pointerup",()=>{console.log("createButton pointerup"),setTimeout(()=>{this.recorder.stopRecording()},500)}),t.addEventListener("pointerover",()=>{console.log("up, stop rec"),this.recorder.stopRecording()}),addEventListenerForActualClick(document.body,e=>{"INPUT"===e.target.tagName?model.supportedInputTypeList.includes(e.target.type)&&moveToElement(t,e.target):("TEXTAREA"===e.target.tagName||!0===e.target.isContentEditable)&&moveToElement(t,e.target),console.log(e.target,e.target.isContentEditable?"editable":"noneditable")}),window.addEventListener("resize",()=>{let e=t.getBoundingClientRect();e.top>window.innerHeight-e.height&&(t.style.top=window.innerHeight-e.height+"px"),console.log("resize",e.top,window.innerHeight)}),t},monitorFocus(){let e=e=>{moveToElement(this.elem.voiceButton,e)};setInterval(()=>{null===document.querySelector("#whisper_voice_button")&&(console.log("no voicebutton, create it now"),this.createButton())},3e3);let t=document.querySelectorAll("input, textarea");t.forEach(t=>{t.addEventListener("focus",()=>{e(t)})});let o=new MutationObserver(t=>{for(let o of t)if("childList"===o.type)for(let n of o.addedNodes)("TEXTAREA"===n.tagName||"INPUT"===n.tagName)&&(console.log("New textarea added:",n),n.addEventListener("focus",t=>{e(n),console.log("New ",n.id||n.name,"gained focus")}))});o.observe(document.body,{childList:!0,subtree:!0})}};async function sendAudioToApi(e,t){try{let o=new FormData;o.append("file",e),o.append("model","whisper-1");let n=await fetch(`${API_URL}/v1/audio/transcriptions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`},body:o});if(!n.ok)throw Error(`Error from API: ${n.statusText}`);let i=await n.json();t.value+=" "+i.text,t.focus(),document.execCommand("insertText",!1,"\n")}catch(r){console.error("Error sending audio to the API:",r)}}async function sendAudioToLeptonWhisperApi(e,t,o){let n=devilentLIBS.showToast;n("transcribing"),o=o||"data:audio/mpeg;base64,";let i=await fetch("https://corsp.suisuy.eu.org/?https://whisperx.lepton.run/run",{method:"POST",headers:{Authorization:"Bearer jl9xg3km3plgxmtk835jvjmzra3x2qzf","Content-Type":"application/json"},body:JSON.stringify({input:o+await blobToBase64(e),language:t||""})});if(!i.ok)return console.log(i),n("transcribe error: "+i.statusText),!1;let r=await i.json();return(console.log(r),r[0]?.text)?r[0].text:(n("transcribe error: "+JSON.stringify(r)),!1)}async function whisperjaxws(e){let t=new WebSocket("wss://sanchit-gandhi-whisper-jax.hf.space/queue/join");return t.addEventListener("open",function(e){console.log("Connected to the server.")}),t.addEventListener("close",function(e){console.log("Disconnected from the server.")}),t.addEventListener("error",function(e){console.error("WebSocket error:",e)}),new Promise(async(o,n)=>{t.addEventListener("message",async function(n){console.log("Message from server:",n.data);let i=JSON.parse(n.data),r="aaeegg"+function e(t,o){if(isNaN(t)||isNaN(o)||t>=o)throw Error("Invalid min or max values. min must be less than max.");return Math.floor(Math.random()*(o-t+1))+t}(900,1e3);if("send_hash"===i.msg)t.send(JSON.stringify({fn_index:0,session_hash:r}));else if("send_data"===i.msg){let a="data:audio/wav;base64,"+await blobToBase64(e);t.send(JSON.stringify({data:[{data:a,name:"audio.wav"},"transcribe",!1,],event_data:null,fn_index:0,session_hash:r}))}else if("estimation"===i.msg)console.log(`Estimated processing time: ${i.rank_eta} seconds`);else if("process_completed"===i.msg){let s=i.output.data[0];console.log(s),o(s)}console.log(i)})})}async function sendAudioToCFWhisperApi(e){try{let t=new FormData;t.append("file",e);let o=await fetch(`${API_URL}/v1/audio/transcriptions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`},body:t});if(!o.ok)throw Error(`Error from API: ${o.statusText}`);let n=await o.json();return console.log(n),n}catch(i){console.error("Error sending audio to the API:",i)}}view.init(),console.log("end script");  })();
